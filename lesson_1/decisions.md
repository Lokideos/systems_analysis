# Решений в процессе ES

## Event Storming

1. Было решено не включать подтверждение выполнениея заказа Клиента в систему так как в [US-070] описано, что 
подтверждение работы будет предоставлять кот-воркер в бумажном виде от клиента. [US-070] противоречит [US-030], где 
сказано, что статус задачи может менять только клиент, но так как нет возможности уточнить требования, то я решил 
остановиться на текущем решении.
2. Элементы системы были сгруппированы по контекстам в соответствии с их функцией:
   - Контекст выполнение задач содержит вся для жизненного цикла задач (статусы и типы задач, необходимые роли)
   - Снабжение расходниками содержит логику для укомплектовки кота-воркера необходимыми инструментами (включая 
   интеграцию с подрядчиком печенья)
   - Рекрутинг котов изолируют в себе логику найма новых котов-воркеров
   - Контроль качества изолирует в себе логику изучения качества работы котов над отменнными/проваленными задачами 
   и отправки соответствующих отчетов клиентам и котам
   - Ставки изолируют в себе логику ставок на задачи
   - Биллинг содержит в себе логику связанную с бухгалтерией (bookkeeping) и проведением оплаты (payments)

## Data Modelling

1. Зачастую Billing и Payments домены разделяют, но я решил не переусложнять текущий дизайн.
2. В иделе в контексте Биллинга лучше завести отдельную сущность Account, где можно трекать все денежные операции, но пока 
я решил не заморачиваться с этим.
3. В контексте "Выполнение Задач" сущность "Просьба о помощи" выделена из [US-010]
4. В идеале лучше создать отдельную сущность Engagement для Задачи, где можно инкапсулировать логику выполнения этой задачи. 
Это позволит нам лучше выполнить часть требований (например, [US-070])
5. Несмотря на то что Менеджер, Клиент и Кот-воркер выделны в разные сущности, в имплементации будет отдельно выделена 
сущность User и сущность Role (Role может принимать значения Cat-Worker, Client & Manager).

## Communications

1. Для разделения между бизнес эвентами и стримингами я использовал следующую логику:
   - Если в результате эвента должно что-то произойти в другом контексте, то это бизнес эвента
   - Если для работы другого контекста нужны какие-то данные, то это CUD эвент

## Реализация проекта

Для имплементации проекта я решил выбрать [SOA](https://en.wikipedia.org/wiki/Service-oriented_architecture).
При этом какие-то сервисы будут больше (e.g., платформа для выполнения задач), а какие-то меньше (e.g., ставки).
Так как в приоритете TTM, то я решил выделить три сервиса:
1. Платформа задач, включающая в себя следующие контексты (где каждый контекст выделен в отдельный модуль внутри сервиса):
   - Выполнение задач
   - Снабжение расходниками
   - Контроль качества
   - Ставки
2. Биллинг
3. Рекрутинг

### Платформа задач

В платформе на старте проекта будет находиться большинство контекстов, что позволит ускорить разработку проекта и 
облегчит его поддержку.

### Биллинг

Биллинг выделен в отдельный сервис, чтобы заэнфорсить границы с этим контекстом. Отдельный сервис я решил создать 
исходя из своего опыта. Протекание абстракций в контекст биллинга и из него имеет крайне негативные последствия и, обычно, 
такое сложно рефакторить, так что даже с фокусом на TTM я бы делал его отдельным сервисом.

Все коммуникаций с Биллингом будет происходить асинхронно.

### Рекрутинг

Рекрутинг выделен в отдельный сервис, так как:
- Имеет мало пересечений с другими контекстами, то есть будет просто избежать распределенного монолита и отдельно 
развивать этот проект.
- В требованиях описано ([US-081]), что ожидаются высокие нагрузки на эту часть системы. Выделение рекрутинга в отдельный 
сервис позволит легче масштабировать эту часть системы в случае резкого увеличение нагрузки на нее.

## Спорные моменты

1. Не совсем понятно где высчитывать скидку - либо в контексте биллинга, либо в платформе задач.
2. Скорее всего, есть проблемы с неймингом (e.g. Акканут в биллинг контексте - это именно акканут с Debit/Credit'ом) 
3. не уверен стоит ли указывать <User> и <Role> в Data Model. С одной стороны это лучше отразит имплементацию, а с
другой явно указывая сущности Cat-Worker, Manager и Client мы улучшаем видимость контекста с точки зрения бизнеса.
4. никак не мог определиться на русском или на английском обозначать термины. На работе всегда все обозначаю на 
английском, но тут требования на русском.
5. Я не уверен, что владельцем сущности "Характеристика Кота" должен быть контекст "Рекрутинг Котов". Несмотря на то, 
что после успешного найма кота-воркера именно в "Рекрутинге Котов" формируется изначальная характеристика, в дальнейшем
она может меняться и уже менять ее в контектсе "Рекрутинга" имеет мало смысла. Возможно, что после отправки первого 
бизнес эвента владеть "Харктеристикой" должен контекст "Выполнение задач" (или отдельный контекст, ответственный за роли в системе).
