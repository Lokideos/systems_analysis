# ADR-001

## ADR-001: Выбор архитектурного стиля для проекта Make Cats Free (MCF).

## Status

Accepted

## Context

Основываясь на требованиях и консёрнах стейкхолдеров, было определено, что  необходимо реализовать систему из 
десяти боундед-контекстов, каждый из которых имеет свой набор характеристик.

Маппинг характеристик на контексты - https://miro.com/app/board/uXjVLrCcUFQ=/?moveToWidget=3458764615766035940&cot=14

Причины для определения характеристик:
* scalability и elascticity
  * Консерн менеджмента о высокой нагрузке на систему менеджмента задач
  * Требование [US-081] о высокой нагрузке и пиках нагрузки на систему рекрутинга
* securability
  * Консерн топ-менеджмента о возможных утечках данных и хранении всех данных и кода у себя
  * Консерн менеджмента о доступе к тотализатору
* consistency
  * Консерн отдела финансов о хранении данных в связанных с расчетами системах
* agility, testability и deployability
  * Так как нам важен низкий TTM
* Configurability
  * Консерн отдела финансов по поводу смены платежных систем для клиентов
  * Требование об интеграции с внешним подрядчиком для доставки печенья - [US-150]
* Modifiability, Evolvability и Simplicity
  * [US-300] для контекста "Алгоритм Матчинга" - нам необходимо быстро менять/добавлять/удалять шаги из алгоритма
* Modifiability и Maintainability
  * Для контекстов "Тестирование котов" и "Алгоритм Мачинга" из-за их высокой сложности

Дополнительные ограничения:
* Нам необходимо хранить данные в соответветствии с CatFinComplience
* Мы ожидаем DDoS атаки на рекрутинг - [US-081]. Необходимо обезопасить себя, заключив соглашение с Qrator/Cloudflare.

Для выбора подходящей архитектуры исходя из полученных требований будут рассматриваться следующие архитектурные стили:
![arch_chars_mapping_on_arch_styles.png](arch_chars_mapping_on_arch_styles.png)

## Decision

Я принял решение выбрать микросервисы в качестве архитектурного стиля для MCF.

На всю систему распространяются следующие характеристики:
* agility
* testability
* deployability
* securability

По ним лучше всего подойдут микросервисы и сервисы.
У этих стилей отличие в использовании общей (для сервисов) или отдельных (для микросервисов) БД.
Для определения решения в нашем случае я опирался на следующие выводы:
* Для расчета зарплаты нам важно соблюдение компаленса, data consistency, так что тут отдельная RDBMS БД.
* Для сервисов с потенциально высокой нагрузкой (организация задач, рекрутинг) нам понадобятся Key-Value БД
* Остальные сервисы также будут использовать RDBMS БД и, чтобы не испытывать проблем с подсчетом необходимого числа
connection'ов и поддержки общей схемы, то было решено использовать для каждого сервиса отдельную БД.

Исходя из этого было решено использовать микросервисы.

## Compliance

Для проверки реализации данного архитектурного решения будут использоваться следующие фитнес-функции:
* Интеграция с codecov для проверки line- и branch- code coverage.
* Реализация кода в Rails Engines + Packwerk для контроля coupling/cohesion внутри сервисов
* Интеграция Jira с BigQuery для сбора статистики по релизу проектов и их последующей оценке
* Имплементация трассировки для последующей визуализации сервисов в datadog или аналогах
